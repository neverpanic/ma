% vim:noet:sts=2:ts=2:sw=2:smarttab:tw=120

\chapter{Extended Escape Analysis}
	\label{chapter:eea}
	Explain what scope extension is, why we think it is a good idea and give a brief overview of how the information
	required can be computed from the results generated by escape analysis.

	\section{Algorithmic Idea}
		\label{sec:eea:idea}
		Give an example of the pattern we are trying to achieve in C and compare with a Java implementation that returns
		a freshly allocated object. Observe that we need garbage collection to reclaim this object. Explain how we are
		trying to reduce the need for garbage collection by deducing which objects are no longer needed and can be freed.
		See~\Cref{test}.

		\begin{thesiscode}[gobble=4]{java}{test}{An example Java code listing}{%
				An example Java code listing. The \texttt{getArray()} method allocates an array and returns it to the caller,
				which uses and discards it. An implementation in C might instead allocate the array on the stack of the calling
				function and pass a pointer to the equivalent of \texttt{getArray()} to fill it, making the memory management
				automatic. In Java, the allocated array requires garbage collection.
			}
				class Example implements Runnable {
					public void getArray() {
						char[] arr = new char[26];
						for (int i = 0; i < arr.length; ++i) {
							arr[i] = 'a' + i;
						}
						return arr;
					}

					@Override
					public void run() {
						char[] letters = getArray();
						for (char c : letters) {
							System.out.println(c);
						}
					}
				}\end{thesiscode}

	\section{Analysis}
		\label{sec:eea:analysis}
		Give an overview of the algorithm JINO uses to extend the scope of a variable. Explain how and why it works and why
		we use stack allocation (and make sure to point out that stack allocation isn't the only possible optimization and
		may in fact be not the best). Quote my future work list on what other cool stuff could be done here and also outline
		which problems make this a hard problem.

		\subsection{Nonvirtual Calls}
			\label{sub:eea:analysis:nonvirtual}
			Describe what we do for non-virtual calls (those are the easy ones!) and how the optimization applies.

		\subsection{Virtual Calls}
			\label{sub:eea:analysis:virtual}
			Explain why virtual method calls are a much harder problem for scope extension and which possibilities can be
			employed to also apply the optimization in these cases (i.e., create a copy that has the optimization enabled, do
			not move the allocation but add explicit \texttt{free(3)}s, or employ some other method of automatic region
			inference).

	\section{Optimization}
		\label{sec:eea:opt}

		\subsection{Extending Variable Scope}
			\label{sub:eea:opt:scopeext}

		\subsection{Local Domain Heaps}
			\label{sub:eea:opt:ldh}
