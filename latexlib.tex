% vim:noet:sts=2:ts=2:sw=2:smarttab:tw=120

% layout einstellungen
\NeedsTeXFormat{LaTeX2e}
\documentclass[
	twoside,
	paper=a4,
	headsepline,     % linie unter kopfzeilen
	headings=normal, % größe der überschriften, standard ist viel zu groß
	abstract,        % Überschrift über dem Abstract
	titlepage=false,
	BCOR=1cm
%	draft
]{scrreprt}

% I *want* all lists of stuff to have a number (even the bibliography, despite the authors of KOMA thinking that this
% isn't a good idea). Also, these shouldn't be chapters (again, the KOMA authors tell me they know better…) but sections
% in an Appendix chapter.
\KOMAoption{toc}{listofnumbered}
\KOMAoption{toc}{bibliographynumbered}
\KOMAoption{listof}{leveldown}
\KOMAExecuteOptions{fontsize=12pt}

\usepackage[pdftex]{graphicx}
% Bilder werden auch im Unterverzeichnis images/ gesucht
\graphicspath{{images/}}

\usepackage{standalone}
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}

% load tikz and pgfplots
\usepackage{tikz}
\usepackage{pgfplots}
\pgfplotsset{compat=1.8}
\usepackage{pgfplotstable}

% tikz libs and settings
\usetikzlibrary{arrows,shapes,decorations,positioning,calc,decorations.markings,pgfplots.groupplots}
\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}

% set and load fonts
\usepackage{fontspec}
\setmainfont{Latin Modern Roman}
\setsansfont[Scale = MatchLowercase]{Latin Modern Sans}
\setmonofont[Scale = MatchLowercase]{Latin Modern Mono}

% load successor package of babel for LuaTeX and load the language files
\usepackage{polyglossia}
\setmainlanguage[variant=american]{english}
\setotherlanguage[latesthyphen=true]{german}

% headings
\usepackage[automark]{scrpage2}
\pagestyle{scrheadings}

% enable the use of \enquote{} with typographically correct markers
\usepackage[autostyle]{csquotes}

% format caption texts
\usepackage{caption}
\renewcommand{\captionfont}{\small}
\renewcommand{\captionlabelfont}{\small\rmfamily\bfseries}
\setlength{\captionmargin}{1em}
\setlength{\abovecaptionskip}{1em}
\setlength{\belowcaptionskip}{1em}

% allow inline enumerations
\usepackage{paralist}

% nice package to outline algorithms
\usepackage[algoruled,algochapter,titlenumbered,linesnumbered,commentsnumbered,vlined]{algorithm2e}

% load this close to the end
\usepackage{hyperref}
\hypersetup{%
	pdfpagemode=UseNone,%
	pdfpagelayout=TwoPageRight,%
	colorlinks=true,%
	linkcolor=blue,%
	citecolor=blue,
	urlcolor=blue,%
	pdfauthor={\thesisauthor},%
	pdftitle={\thesistitle},
	pdfsubject={\thesistitle},
	pdfkeywords={\thesiskeywords},
	pdfstartpage=1%
}

% load glossaries, needs to be after hyperref
\usepackage[acronym,nomain,toc,savewrites,section,numberedsection=autolabel]{glossaries}
% enable glossaries
\input{glossary}
\makeglossaries{}

% headings
\usepackage{titlesec}
\titleformat{\chapter}[hang]{\Huge\rmfamily}{%
	\parbox{1.2cm}{\thechapter{}}%
	\parbox{0.8cm}{\centering\textcolor{white!75!black}{|}}}{0pt}{\Huge\rmfamily}
\titleformat{\section}[hang]{\Large\rmfamily}{%
	\parbox{1.2cm}{\thesection{}}%
	\parbox{0.8cm}{\centering\textcolor{white!75!black}{|}}}{0pt}{\Large\rmfamily}
\titleformat{\subsection}[hang]{\large\rmfamily}{%
	\parbox{1.2cm}{\thesubsection{}}%
	\parbox{0.8cm}{\centering\textcolor{white!75!black}{|}}}{0pt}{\large\rmfamily}
\titleformat{\subsubsection}[hang]{\rmfamily}{%
	\parbox{1.2cm}{\thesubsubsection{}}%
	\parbox{0.8cm}{\centering\textcolor{white!75!black}{|}}}{0pt}{\rmfamily}
\titleformat{\subsubsection}[hang]{\rmfamily}{%
	\parbox{1.2cm}{\theparagraph{}}%
	\parbox{0.8cm}{\centering\textcolor{white!75!black}{|}}}{0pt}{\rmfamily}
\setkomafont{sectioning}{\rmfamily\bfseries}
\setkomafont{descriptionlabel}{\rmfamily\bfseries}

% increase emergency stretch to prevent overfull hboxes
\setlength{\emergencystretch}{1em}
\setlength{\parskip}{0.2em}

% maximum ToC depth
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}

% Some useful todonotes-macros
\usepackage[colorinlistoftodos]{todonotes}
\usepackage{ulem} % for \uwave
\newcommand{\reword}[1]{%
	\parbox{\textwidth}{\uwave{#1}}\todo[color=GreenYellow]{Reword}%
	\xspace%
}
\newcommand{\missingref}[1]{%
	\uwave{$\backslash$ref\{#1\}}%
	\todo[color=Dandelion]{Missing reference}%
	\xspace%
}
\newcommand{\missingcite}[1]{%
	\uwave{[{\tiny\ldots}]}%
	\todo[color=Dandelion]{Missing $\backslash$cite: #1}%
	\xspace%
}
\newcommand{\todonote}[1]{%
	\todo[inline]{#1}%
}
\newcommand{\todobox}[2]{%
	\todo[inline,caption=#1]{%
	\begin{minipage}{\linewidth}%
		#1%
		#2%
	\end{minipage}%
	}%
}
\newcommand{\todomark}[2]{%
	\uwave{#1}\todo{#2}%
	\xspace%
}

% source code listings
\usepackage[chapter]{minted}
\usemintedstyle{friendly}
%\newminted{c}{%
%	linenos,
%	tabsize = 2,
%	xleftmargin = 2em}
%\newminted{java}{%
%	linenos,
%	tabsize = 2,
%	xleftmargin = 2em}

% nice references with automatic naming
\usepackage[nameinlink,capitalize]{cleveref}

% Provide nice boxes for my source code listings. Cats love boxes.
% Note: This needs tcolorbox 3.0, which isn't in texlive 2013
\usepackage{tcolorbox}
\tcbuselibrary{skins}
\tcbuselibrary{minted}
\tcbset{%
	thesiscode/.style 2 args = {%
		listing engine = minted,
		minted style = friendly,
		minted language = #2,
		minted options = {%
			linenos,
			tabsize = 2,
			numbersep = 3mm,
			fontsize = \small,
			#1
		},
		colback = black!5!white,
		colframe = black!75!white,
		fonttitle = \bfseries,
		listing and comment,
		enhanced,
		segmentation hidden,
		arc = 0pt,
		left = 5mm,
		float,
		overlay = {%
			\begin{tcbclipinterior}
				\fill[black!20!white] (frame.south west) rectangle ([xshift=5mm]frame.north west);
			\end{tcbclipinterior}
		}
	},
	thesiscodetitled/.style n args = {4}{%
		thesiscode={#1}{#2},
		label={#3},
		title={Listing~\thetcbcounter: #4}
	}
}
\newtcblisting[auto counter,crefname={listing}{listings},Crefname={Listing}{Listings}]{thesiscode}[5][]{%
	thesiscodetitled={#1}{#2}{#3}{#4},
	comment={\footnotesize{}#5}}
\newtcbinputlisting[use counter from=thesiscode]{\inputthesiscode}[5][]{%
	thesiscodetitled={#1}{#2}{#3}{#4},
	comment={\footnotesize{}#5}}
